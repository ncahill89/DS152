<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Experimental Studies – Introduction to Data Science (2)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#establishing-causality" id="toc-establishing-causality" class="nav-link active" data-scroll-target="#establishing-causality">Establishing Causality</a></li>
  <li><a href="#controlled-experiments" id="toc-controlled-experiments" class="nav-link" data-scroll-target="#controlled-experiments">Controlled Experiments</a></li>
  <li><a href="#general-considerations" id="toc-general-considerations" class="nav-link" data-scroll-target="#general-considerations">General Considerations</a></li>
  <li><a href="#steps-of-experimentation" id="toc-steps-of-experimentation" class="nav-link" data-scroll-target="#steps-of-experimentation">Steps of Experimentation</a></li>
  <li><a href="#determination-of-the-levels-of-a-factor" id="toc-determination-of-the-levels-of-a-factor" class="nav-link" data-scroll-target="#determination-of-the-levels-of-a-factor">Determination of the levels of a factor</a></li>
  <li><a href="#the-three-key-principles-of-experimentation" id="toc-the-three-key-principles-of-experimentation" class="nav-link" data-scroll-target="#the-three-key-principles-of-experimentation">The Three Key Principles of Experimentation</a>
  <ul class="collapse">
  <li><a href="#randomization" id="toc-randomization" class="nav-link" data-scroll-target="#randomization">Randomization</a></li>
  <li><a href="#randomization-1" id="toc-randomization-1" class="nav-link" data-scroll-target="#randomization-1">Randomization</a></li>
  <li><a href="#internal-validity" id="toc-internal-validity" class="nav-link" data-scroll-target="#internal-validity">Internal validity</a></li>
  <li><a href="#external-validity" id="toc-external-validity" class="nav-link" data-scroll-target="#external-validity">External validity</a></li>
  <li><a href="#blocking" id="toc-blocking" class="nav-link" data-scroll-target="#blocking">Blocking</a></li>
  <li><a href="#blocking-example" id="toc-blocking-example" class="nav-link" data-scroll-target="#blocking-example">Blocking Example</a></li>
  <li><a href="#main-types-of-blocks" id="toc-main-types-of-blocks" class="nav-link" data-scroll-target="#main-types-of-blocks">Main types of blocks</a></li>
  <li><a href="#randomized-complete-block-design" id="toc-randomized-complete-block-design" class="nav-link" data-scroll-target="#randomized-complete-block-design">Randomized Complete Block Design</a></li>
  <li><a href="#randomized-complete-block-design---example" id="toc-randomized-complete-block-design---example" class="nav-link" data-scroll-target="#randomized-complete-block-design---example">Randomized Complete Block Design - Example</a></li>
  <li><a href="#factorial-experiments" id="toc-factorial-experiments" class="nav-link" data-scroll-target="#factorial-experiments">Factorial Experiments</a></li>
  <li><a href="#using-an-interaction-plot" id="toc-using-an-interaction-plot" class="nav-link" data-scroll-target="#using-an-interaction-plot">Using an Interaction Plot</a></li>
  </ul></li>
  <li><a href="#steps-of-experimentation-1" id="toc-steps-of-experimentation-1" class="nav-link" data-scroll-target="#steps-of-experimentation-1">Steps of Experimentation</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Experimental Studies</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="establishing-causality" class="level2">
<h2 class="anchored" data-anchor-id="establishing-causality">Establishing Causality</h2>
<ul>
<li><p>A treatment will often be a binary variable that is either 0 or 1.</p>
<ul>
<li>It is 0 if the person is not treated, which is to say they are in the control group, and 1 if they are treated.</li>
</ul></li>
<li><p>We will typically have some outcome of interest, Y, for each person, and that could be categorical or continuous.</p></li>
<li><p>A treatment is causal if the outcome for a person given they were not treated, is different to their outcome given they were treated.</p>
<ul>
<li>If we could both treat and control the one individual at the one time, then we would know that it was only the treatment that had caused any change</li>
</ul></li>
<li><p>The fundamental problem of causal inference is that we cannot both treat and control the one individual at the one time.</p>
<ul>
<li><p>we instead compare the average of two groups — all those treated and all those not.</p></li>
<li><p>we estimate the counterfactual at a group level because of the impossibility of doing it at an individual level.</p></li>
<li><p>this trade-off allows us to move forward but comes at the cost of certainty.</p></li>
<li><p>we must instead rely on randomization, probabilities, and expectations.</p></li>
</ul></li>
</ul>
</section>
<section id="controlled-experiments" class="level2">
<h2 class="anchored" data-anchor-id="controlled-experiments">Controlled Experiments</h2>
<ul>
<li><p>Controlled Experiments are a scientific test (or a series of tests) to verify how one or more conditions (treatments - variables that are controlled by the scientist) affect one or more outcome (response) variables.</p></li>
<li><p>We usually consider a default of there being no effect and we look for evidence that would cause us to change our mind.</p></li>
<li><p>Adequate planning is crucial to experimental success.</p></li>
<li><p><strong>Design of experiments:</strong> can produce an experiment that efficiently answers the questions of interest, optimizing the information for the available resources.</p></li>
<li><p>The scientific method involves</p>
<ol type="a">
<li>Stating a hypothesis</li>
<li>Planning an experiment to objectively test the hypothesis</li>
<li>Observing and carefully collecting data</li>
<li>Interpreting experimental results (test your hypothesis)</li>
</ol></li>
</ul>
</section>
<section id="general-considerations" class="level2">
<h2 class="anchored" data-anchor-id="general-considerations">General Considerations</h2>
<ul>
<li><p><strong>Basic considerations of experimentation</strong></p>
<ul>
<li><p>Provide a valid comparison between treatments</p></li>
<li><p>Provide valid information on the relationship between variables of interest</p></li>
</ul></li>
<li><p><strong>Basic requisites</strong></p>
<ul>
<li><p>The experimental conditions must represent real conditions of the problem of interest</p></li>
<li><p>Treatment comparison must be made free from other possible explanations due to the presence of other variables (<em>confounding</em>)</p></li>
<li><p>Treatment comparison must be made with the lowest possible influence from random variation</p></li>
<li><p>The uncertainty level of the conclusions must be known</p></li>
<li><p>The experiment must be the simplest <strong>possible</strong></p></li>
</ul></li>
</ul>
</section>
<section id="steps-of-experimentation" class="level2">
<h2 class="anchored" data-anchor-id="steps-of-experimentation">Steps of Experimentation</h2>
<p><strong>(1) Clear and precise definition of the problem and objectives</strong></p>
<ul>
<li><p>objectives <span class="math inline">\(\rightarrow\)</span> scientific hypotheses <span class="math inline">\(\rightarrow\)</span> statistical hypotheses</p></li>
<li><p>single objective vs.&nbsp;multiple objectives</p>
<ul>
<li><p>e.g., examine the effect of Vitamin C on the length of the odontoplasts, the cells responsible for teeth growth</p></li>
<li><p>e.g.&nbsp;determine the lethal dose of a pesticide for an agricultural pest</p></li>
<li><p>e.g.&nbsp;determine the best temperature settings so that a machine may work properly</p></li>
</ul></li>
</ul>
<p><strong>(2) Definition of the conditions of the experiment</strong></p>
<ul>
<li><p>Controlled conditions</p>
<ul>
<li>e.g.&nbsp;greenhouses, laboratories, experimental stations etc.</li>
</ul></li>
<li><p>Less controlled conditions</p>
<ul>
<li>e.g.&nbsp;farms, forests etc.</li>
</ul></li>
<li><p>Research programmes</p>
<ul>
<li>Preliminary, main and confirmation trials</li>
</ul></li>
<li><p>Selection programmes</p>
<ul>
<li>Screening, comparative and multilocal trials</li>
</ul></li>
</ul>
<p><strong>(3) Identification of the variables of interest</strong></p>
<ul>
<li><p>Response variable</p>
<ul>
<li><p>e.g., length of odontoplasts in guinea pigs</p></li>
<li><p>e.g., blood pressure rates</p></li>
</ul></li>
<li><p>Treatment factor(s) and their levels</p>
<ul>
<li><p>Quantitative – factor: doses of vitamin C (levels: 0.5, 1, 2 milligrams/day)</p></li>
<li><p>Qualitative – factor: diet (levels: natural and artificial)</p></li>
</ul></li>
<li><p>Local control factor(s) and their levels</p>
<ul>
<li>blocks, rows, columns; <em>nuisance</em> factors, reflecting experimental design</li>
</ul></li>
</ul>
</section>
<section id="determination-of-the-levels-of-a-factor" class="level2">
<h2 class="anchored" data-anchor-id="determination-of-the-levels-of-a-factor">Determination of the levels of a factor</h2>
<ul>
<li><p><strong>Selection:</strong> obtain the best treatments within a big set of treatments</p></li>
<li><p><strong>Comparison:</strong> a small group of treatments that qualitatively differ is compared to establish differences</p>
<ul>
<li><p>e.g.&nbsp;comparison between the effects of two different diets on blood pressure</p></li>
<li><p>e.g., comparison of delivery method of vitamin C (orange juice or ascorbic acid)</p></li>
</ul></li>
<li><p><strong>Optimization:</strong> find the optimal level within a group of treatments</p>
<ul>
<li>e.g.&nbsp;dose-response experiments</li>
</ul></li>
</ul>
<p><strong>(4) Identification of the experimental and observational unit</strong></p>
<ul>
<li><p><strong>Experimental unit:</strong> individual or group of individuals in which a treatment is randomly applied; may give rise to one or more experimental units</p>
<ul>
<li>e.g.&nbsp;60 guinea pigs, a plot of land with 200 trees, a section of a laboratory bench with 20 Petri dishes, etc</li>
</ul></li>
<li><p><strong>Observational unit:</strong> physical entity that produces a unique value for the response variable</p>
<ul>
<li>e.g.&nbsp;a single insect, a single tree, a single Petri dish</li>
</ul></li>
</ul>
<p><strong>(5) Definition of the observations to be made</strong></p>
<ul>
<li><p>Observations: essential or accessory</p></li>
<li><p><strong>Qualitative:</strong> presence or absence of a morphological feature,</p></li>
<li><p><strong>Quantitative:</strong> weight, counts, proportion survived, proportion damaged</p></li>
<li><p><strong>Ordered:</strong> degree of severity of a disease, grading scale <span class="math inline">\(\rightarrow\)</span> relationship of order</p></li>
<li><p>Important things to be aware of:</p>
<ul>
<li><p>The way observations will be taken</p></li>
<li><p>The way they will be registered</p></li>
<li><p>If sampling: define the number and size of samples (consider representativeness)</p></li>
</ul></li>
</ul>
<p><strong>(6) Selection of the experimental scheme</strong></p>
<ul>
<li><p>Must be the simplest <em>possible</em></p></li>
<li><p>Systematic experiments: must <strong>not</strong> be used</p></li>
<li><p>Randomized experiments: allow for the comparison of treatments, <em>free from confounding</em></p></li>
</ul>
</section>
<section id="the-three-key-principles-of-experimentation" class="level2">
<h2 class="anchored" data-anchor-id="the-three-key-principles-of-experimentation">The Three Key Principles of Experimentation</h2>
<ul>
<li><p><strong>Randomization:</strong> is the assignment of treatments to experimental units so that every unit has the same probability of receiving each treatment.</p></li>
<li><p><strong>Replication:</strong> provides a measurement of uncontrolled variation; it is the application of each treatment several times, i.e.&nbsp;to several experimental units</p></li>
<li><p><strong>Local control:</strong> is the grouping of experimental units into groups called BLOCKS, the units within a group being as similar as possible (e.g.&nbsp;different growth chambers, people, time periods, different trays in a lab bench, etc)</p></li>
</ul>
<section id="randomization" class="level3">
<h3 class="anchored" data-anchor-id="randomization">Randomization</h3>
<ul>
<li><p>The key to telling a causal story is the counterfactual: what would have happened in the absence of the treatment.</p>
<ul>
<li>This means that establishing the control group is critical because when we do that, we establish the counterfactual.</li>
</ul></li>
<li><p>What we hope to be able to do is to find treatment and control groups that are the same, but for the treatment.</p>
<ul>
<li><p>We might be worried about, say, underlying trends, which is one issue with a before-and-after comparison, or selection bias, which could occur when we allow self-selection. Either of these issues could result in biased estimators.</p></li>
<li><p>We use randomization to go some way to addressing these.</p></li>
</ul></li>
</ul>
</section>
<section id="randomization-1" class="level3">
<h3 class="anchored" data-anchor-id="randomization-1">Randomization</h3>
<p>To explore ideas of randomization, we simulate a population, and then randomly sample from it. We will set it up so that 20% of the population are smokers, and the rest are not.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>number_of_people <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">person =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>number_of_people),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoking_status =</span> <span class="fu">sample</span>(</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Smoker"</span>, <span class="st">"Non-Smoker"</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">size  =</span> number_of_people,</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">replace =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>,<span class="fl">0.8</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s look at population characteristics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>population <span class="sc">%&gt;%</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(smoking_status)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  smoking_status     n
  &lt;chr&gt;          &lt;int&gt;
1 Non-Smoker      4003
2 Smoker           997</code></pre>
</div>
</div>
<p>Now let’s sample from the population and randomly assign a treatment and control group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">853</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  population <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(sample_size) <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">sample</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">c</span>(<span class="st">"Treatment"</span>, <span class="st">"Control"</span>),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">size  =</span> sample_size,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">TRUE</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s look at sample characteristics within each group (treatment and control). Is the distribution of population characteristics reflected within each group?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>sample <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(group,  smoking_status) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   group [2]
  group     smoking_status     n  prop
  &lt;chr&gt;     &lt;chr&gt;          &lt;int&gt; &lt;dbl&gt;
1 Control   Non-Smoker       364 0.747
2 Control   Smoker           123 0.253
3 Treatment Non-Smoker       415 0.809
4 Treatment Smoker            98 0.191</code></pre>
</div>
</div>
</section>
<section id="internal-validity" class="level3">
<h3 class="anchored" data-anchor-id="internal-validity">Internal validity</h3>
<ul>
<li><p>If the treated and control groups are the same in all ways and remain that way, but for the treatment, then we have internal validity, which is to say that our control will work as a counterfactual and our results can speak to a difference between the groups in that study.</p></li>
<li><p>Internal validity means that our estimates of the effect of the treatment are speaking to the treatment and not some other aspect.</p></li>
<li><p>They mean that we can use our results to make claims about what happened in the experiment.</p></li>
</ul>
</section>
<section id="external-validity" class="level3">
<h3 class="anchored" data-anchor-id="external-validity">External validity</h3>
<ul>
<li><p>If the group to which we applied our randomization were representative of the broader population, and the experimental set-up were fairly similar to outside conditions, then we further could have external validity.</p>
<ul>
<li><p>That would mean that the difference we find does not just apply in our own experiment, but also in the broader population.</p></li>
<li><p>External validity means that we can use our experiment to make claims about what would happen outside the experiment.</p></li>
<li><p>It is randomization that has allowed that to happen.</p></li>
</ul></li>
<li><p>But this means we need randomization twice. Firstly, into the group that was subject to the experiment, and then secondly, between treatment and control.</p></li>
</ul>
</section>
<section id="blocking" class="level3">
<h3 class="anchored" data-anchor-id="blocking">Blocking</h3>
<ul>
<li><p>Often there are covariates in the experimental units that are known to affect the response variable and must be taken into account.</p></li>
<li><p>Ideally an experimenter can group the experimental units into blocks where the within block variance is small, but the block to block variability is large.</p>
<ul>
<li>For example, in testing a drug to prevent heart disease, we know that gender and age also impact the outcome. We may want to partition our study participants into gender and age groups and then randomly assign the treatment (placebo vs drug) within the group.</li>
</ul></li>
<li><p>Often blocking variables are not the variables that we are primarily interested in, but must nevertheless be considered. We call these nuisance variables.</p></li>
</ul>
</section>
<section id="blocking-example" class="level3">
<h3 class="anchored" data-anchor-id="blocking-example">Blocking Example</h3>
<p>Example 1. An agricultural field study has three fields in which the researchers will evaluate the quality of three different varieties of barley. Due to how they harvest the barley, we can only create a maximum of three plots in each field. In this example we will block on field since there might be differences in soil type, drainage, etc from field to field. In each field, we will plant all three varieties so that we can tell the difference between varieties without the block effect of field confounding our inference. In this example, the varieties are nested within the fields.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
  Field  Plot Variety Quality
  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
1     1     1 A       value  
2     1     2 B       .      
3     1     3 C       .      
4     2     1 A       .      
5     2     2 B       .      
6     2     3 C       .      
7     3     1 A       .      
8     3     2 B       .      
9     3     3 C       .      </code></pre>
</div>
</div>
</section>
<section id="main-types-of-blocks" class="level3">
<h3 class="anchored" data-anchor-id="main-types-of-blocks">Main types of blocks</h3>
<ul>
<li><p>Natural divisions</p>
<ul>
<li><p>Young animals – litters, egg masses</p></li>
<li><p>People or animals – gender</p></li>
<li><p>Continuous gradient of change</p>
<ul>
<li>Plots on the field – declivity, humidity, fertility</li>
<li>People or animals – age, weight, size</li>
<li>Severity of disease on the field</li>
</ul></li>
<li><p>Experimental management</p>
<ul>
<li>Laboratory procedures – technician, day, stand</li>
<li>Material availability</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="randomized-complete-block-design" class="level3">
<h3 class="anchored" data-anchor-id="randomized-complete-block-design">Randomized Complete Block Design</h3>
<ul>
<li><p>The aim is to have heterogeneity between blocks and homogeneity within</p>
<ul>
<li><p>e.g.&nbsp;a greenhouse with a temperature gradient, different days, different observers</p></li>
<li><p>Block is the replicate</p></li>
<li><p>The number of experimental units per block is equal to the number of treatments and every treatment occurs once in each block, the order of the treatments within a block being randomized</p></li>
</ul></li>
</ul>
<!-- ## Randomized Complete Block Design -->
<!-- Example with four treatments and three blocks -->
<!-- \begin{center} -->
<!-- \includegraphics[width = .9\textwidth]{figures/rcbd.png} -->
<!-- \end{center} -->
<p>Laboratory chamber with a humidity gradient inside</p>
<p><img src="images/bod1.png" class="img-fluid"></p>
<p>Laboratory chambers with homogeneous temperature and humidity inside</p>
<p><img src="images/bod2.png" class="img-fluid"></p>
<p>A field with a fertility gradient</p>
<p><img src="images/field1.png" class="img-fluid"></p>
<p>A greenhouse with a temperature gradient during the day</p>
<p><img src="images/greenhouse1.png" class="img-fluid"></p>
<p>The dataset <code>oatvar</code> in the <code>faraway</code> library contains information about an experiment on eight different varieties of oats.</p>
<ul>
<li><p>The area in which the experiment was done had some systematic variability and the researchers divided the area up into five different blocks in which they felt the area inside a block was uniform while acknowledging that some blocks are likely superior to others for growing crops.</p></li>
<li><p>Within each block, the researchers created eight plots and randomly assigned a variety to a plot. This type of design is called a Randomized Complete Block Design (RCBD) because each block contains all possible levels of the factor of primary interest.</p></li>
</ul>
</section>
<section id="randomized-complete-block-design---example" class="level3">
<h3 class="anchored" data-anchor-id="randomized-complete-block-design---example">Randomized Complete Block Design - Example</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">'oatvar'</span>, <span class="at">package=</span><span class="st">'faraway'</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(oatvar, <span class="fu">aes</span>(<span class="at">y=</span>yield, <span class="at">x=</span>block, <span class="at">color=</span>variety)) <span class="sc">+</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.integer</span>(block)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="5-experiments_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="480"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="factorial-experiments" class="level3">
<h3 class="anchored" data-anchor-id="factorial-experiments">Factorial Experiments</h3>
<ul>
<li><p>There may often be more than one factor of interest to the experimenter</p></li>
<li><p>Experiments that involve more than one randomized or treatment factor are called <em>factorial experiments</em></p></li>
<li><p>In general, the number of treatments in a factorial experiment is the product of the numbers of levels of the treatment factors.</p></li>
<li><p>The disadvantage of this is that the number of treatments increase very quickly.</p></li>
</ul>
<p><strong>Example:</strong> Pest control</p>
<ul>
<li>Factor 1: two pesticides (A and B)</li>
<li>Factor 2: two doses</li>
<li>The experiment has a total of <span class="math inline">\(2\times 2 = 4\)</span> treatments</li>
</ul>
<p><strong>Example:</strong> The Tooth Growth data</p>
<ul>
<li>Factor 1: two deliveries of vitamin C (orange juice, ascorbic acid)</li>
<li>Factor 2: three doses (0.5, 1, and 2 mg/day)</li>
<li>The experiment has a total of <span class="math inline">\(2\times 3 = 6\)</span> treatments</li>
</ul>
<!-- \begin{center} -->
<!-- \includegraphics[width = .8\textwidth]{figures/fac1.png} -->
<!-- \end{center} -->
<p>For the Pesticide example, suppose 3 replicates and a completely randomized design</p>
<p><img src="images/fac2.png" class="img-fluid"></p>
<p>For the Pesticide example, suppose 3 replicates and a randomized complete block design</p>
<p><img src="images/fac3.png" class="img-fluid"></p>
<ul>
<li><p>The major advantage of factorial experiments is that they allow for the detection of interactions.</p></li>
<li><p>Two factors are said to interact if the effect of one, on the response variable, depends upon the level of the other.</p></li>
<li><p>If they do not interact, they are said to be <strong>independent</strong>.</p></li>
<li><p>Other terms that are synonymous with “interacting factors” are <strong>dependent</strong> and <strong>nonadditive</strong>.</p></li>
</ul>
</section>
<section id="using-an-interaction-plot" class="level3">
<h3 class="anchored" data-anchor-id="using-an-interaction-plot">Using an Interaction Plot</h3>
<p><img src="images/int1.png" class="img-fluid"></p>
<ul>
<li>A set of parallel lines indicates no interaction</li>
</ul>
<p><img src="images/int3.png" class="img-fluid"></p>
<ul>
<li>Clearly an interaction as lines have different slopes</li>
</ul>
<!-- ## Splitting Interactions -->
<!-- \begin{center} -->
<!-- \includegraphics[width = .9\textwidth]{figures/int4.png} -->
<!-- \end{center} -->
</section>
</section>
<section id="steps-of-experimentation-1" class="level2">
<h2 class="anchored" data-anchor-id="steps-of-experimentation-1">Steps of Experimentation</h2>
<p><strong>(7) Conduction of the experiment</strong></p>
<ul>
<li><p>Bias-free procedures</p></li>
<li><p>Also consider</p>
<ul>
<li><p>Entity carrying out the experiment</p></li>
<li><p>Place of execution</p></li>
<li><p>Start and end dates</p></li>
<li><p>Experiment relevance</p></li>
<li><p>Expenses</p></li>
</ul></li>
</ul>
<p><strong>(8) Data analysis and interpretation of results</strong></p>
<ul>
<li><p>Analysis in accordance with the experimental design</p></li>
<li><p>Interpretation of the results within the experimental conditions, tested hypotheses and related to the previously established facts</p></li>
<li><p>Consequences and probabilities of a wrong decision</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>